<!DOCTYPE html>
<html>
<head>
	<title>Algorithm's Blog</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="keyword" content="algorithm,blog,2018">
	<meta name="author" content="Nguyễn Lê Tuấn Cường,Nguyễn Hồng Anh Tấn">
	<meta name="description" content="This is the blog about algorithms">

	<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../css/fontawesome.min.css">
	<link rel="stylesheet" type="text/css" href="../css/mainpage.css">
</head>
<body>
<div class="main-wrapper">
	<div class="header">
		<div class="container">
			<div class="row">
				<div class="col-sm-8 float-left">
					<a href="https://mail.google.com"><i class="fa fa-envelope"></i><span>cuongnguyenle997@gmail.com</span></a>
				</div>
				<div class="col-sm-1 float-right text-right">
					<a href="account.html"><i class="fa fa-user"></i><span>Account</span></a>
				</div>
				<div class="col-sm-2 float-right text-right">
					<a href="ebook.html"><i class="fa fa-book"></i><span>Algorithm's Ebook</span></a>
				</div>
				<div class="col-sm-1 float-right text-right">
					<i class="fa fa-circle"></i><span>White</span>
				</div>
			</div>
		</div>
	</div>
	<div class="logo">
		<div class="container">
			<div class="row">
				<div class="col-sm-4">
					<div class="logo-image">
						<a href="#">
							<img src="../images/logo.png">
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="menu">
		<div class="container">
			<div class="row">
				<div class="col-sm-1 text-center menu-item current-item">
					<a href="../index.html">HOME</a>
				</div>
				<div class="col-sm-2 text-center menu-item">
					<a href="">BASIC ALGORITHMS</a>
					<div class="menu-sub-items">
						<a href="">Generations</a><br>
						<a href="">Recursive</a><br>
						<a href="">Greedy</a><br>
						<a href="">Divide and conquer</a><br>
						<a href="">Sort</a><br>
						<a href="">Search</a><br>
						<a href="">Big Number</a><br>
					</div>
				</div>
				<div class="col-sm-2 text-center menu-item">
					<a href="">BASIC DATA STRUCTURES</a>
					<div class="menu-sub-items">
						<a href="">Array</a><br>
						<a href="">Linked List</a><br>
						<a href="">Stack</a><br>
						<a href="">Queue</a><br>
						<a href="">Binary Tree</a><br>
						<a href="">Binary Search Tree</a><br>
						<a href="">String</a><br>
						<a href="">Hash</a><br>
					</div>
				</div>
				<div class="col-sm-1 text-center menu-item">
					<a href="">GRAPH</a>
					<div class="menu-sub-items">
						<a href="">Graph Introduce</a><br>
						<a href="">Search</a><br>
						<a href="">DFS</a><br>
						<a href="">BFS</a><br>
						<a href="">Prim</a><br>
						<a href="">Euler</a><br>
						<a href="">Topo</a><br>
					</div>
				</div>
				<div class="col-sm-2 text-center menu-item">
					<a href="">ADVANCED ALGORITHMS</a>
					<div class="menu-sub-items">
						<a href="">Dynamic Programming</a><br>
						<a href="">Bitwise</a><br>
						<a href="">Math</a><br>
					</div>
				</div>
				<div class="col-sm-3 text-center menu-item">
					<a href="">ADVANCED DATA STRUCTURES</a>
					<div class="menu-sub-items">
						<a href="">Disjoint set</a><br>
						<a href="">Trie</a><br>
						<a href="">Segment tree</a><br>
						<a href="">Suffix Array</a><br>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="big-image">
		<div class="col-sm-5 big-image-container float-right">
			<div class="big-image-title">
				2018 Algorithm Blog
			</div>
			<a href="pages/ebook.html"><div class="big-image-button-ebook text-center float-left col-sm-3">
				Ebook
			</div></a>
			<a href="pages/introduce.html"><div class="big-image-button-introduce text-center float-left col-sm-3">
				Introduce
			</div></a>
		</div>
	</div>
	<div class="contact">
		<div class="container">
			<div class="row">
				<div class="col-sm-4 float-left">
					<i class="fa fa-globe"></i>
					<span class="title">BEST EBOOK</span><br>
					<span class="info">From all over the world</span>
				</div>
				<div class="col-sm-4 float-left">
					<i class="fa fa-phone"></i>
					<span class="title">CALL US ANYTIME</span><br>
					<span class="info">+0910242421</span>
				</div>
				<div class="col-sm-4 float-left">
					<i class="fa fa-university"></i>
					<span class="title">OUR LOCATION</span><br>
					<span class="info">Post and Telecomunication Institute of Technology</span>
				</div>
			</div>
			
		</div>	
	</div>
	<div class="content">
		<div class="container">
			<p style="text-align: justify;">Hãy bắt đầu với bài toán sau đây:</p>
	<p style="text-align: justify;">Cho một dãy số gồm n phần tử $latex (n \le 10^5)$, có q truy vấn $latex (q \le 10^5)$ thuộc một trong hai loại sau:</p>

	<ul style="text-align: justify;">
		<li>1 l r: Tìm giá trị lớn nhất của các phần tử có vị trí trong đoạn $latex [l,r]$.</li>
		<li>2 x v: Gán $latex a_x = v$.</li>
	</ul>
	<p style="text-align: justify;">Với $latex n, q \le 10^5$, mỗi truy vấn cần phải thực hiện trong độ phức tạp $latex o(log(n))$ hoặc $latex o(sqrt(n))$. Segment tree sẽ giúp thực hiện truy vấn trên với độ phức tạp $latex o(log(n))$.</p>

	<h2 style="text-align: justify;">Segment tree là gì?</h2>
	<p style="text-align: justify;">Segment tree (cây phân đoạn) là một cấu trúc dữ liệu dạng cây, trong đó mỗi nút sẽ lưu trữ một giá trị nào đó như giá trị lớn nhất, giá trị nhỏ nhất, tổng, v.v. của một đoạn các phần tử liên tiếp trong dãy số. Một nút $latex i$ quản lý một đoạn $latex [l,r]$ gồm nhiều hơn một phần tử sẽ có 2 nút con:</p>

	<ul style="text-align: justify;">
		<li>Nút con trái là nút $latex 2i$, quản lý đoạn $latex [l,m]$.</li>
		<li>Nút con phải là nút $latex 2i+1$, quản lý đoạn $latex [m+1,r]$.</li>
		<li>$latex m =\left\lfloor\dfrac{l+r}{2}\right\rfloor$.</li>
	</ul>
	<p style="text-align: justify;">Ví dụ một segment tree quản lý giá trị lớn nhất của dãy số gồm 6 phần tử: 6, 1, 4, 5, 3, 2.</p>
	<p style="text-align: justify;"><img class=" size-full wp-image-136 aligncenter" src="https://liv1n9.files.wordpress.com/2018/02/segment_tree-11.png" alt="segment_tree (1)" width="505" height="362" /></p>

	<ul style="text-align: justify;">
		<li>Nút gốc quản lý toàn bộ dãy số.</li>
		<li>Nút chỉ quản lý một phần tử $latex (l=r)$ là nút lá.</li>
		<li>Ta có thể sử dụng một mảng một chiều để lưu trữ cây, với mỗi phần tử tương ứng với một nút.</li>
		<li>Một segment tree quản lý một dãy số có kích thước $latex n$ có số nút khoảng $latex 4n$ và độ cao $latex \left\lceil log(n)\right\rceil$.</li>
	</ul>
	<p style="text-align: justify;">Ta sẽ sử dụng ví dụ trên cho bài toán.</p>

	<h2 style="text-align: justify;">Xây dựng cây</h2>
	<p style="text-align: justify;">Ta có cách xây dựng đệ quy sau đây:</p>
	<p style="text-align: justify;">Xét hàm <code>init(k, l, r)</code> có khả năng xây dựng một cây con của segment tree có gốc là nút $latex k$, quản lý đoạn $latex [l,r]$ (cả cây cũng có thể coi là một cây con của nó):</p>

	<ul style="text-align: justify;">
		<li style="text-align: justify;">Nếu nút $latex k$ là nút lá, ta chỉ cần cập nhật giá trị nút này là giá trị phần tử nó quản lý.</li>
		<li style="text-align: justify;">Ngược lại, xây dựng 2 cây con có gốc là nút con trái $latex 2k$ quản lý đoạn $latex [l, m]$ và nút con phải $latex 2k+1$ quản lý đoạn $latex [m+1,r]$ (<code>init(k*2, l, m)</code>, <code>init(k*2+1, m+1, r)</code>). Sau đó giá trị nút $latex k$ là giá trị lớn nhất trong hai giá trị của hai nút con.</li>
	</ul>
	<p style="text-align: justify;"><a href="https://ideone.com/oNauR1" target="_blank" rel="noopener">Code ví dụ</a>.</p>
	<p style="text-align: justify;">Chỉ còn một bước nữa để xây dựng cây, mình sẽ để bạn tự suy luận.</p>

	<h2 style="text-align: justify;">Tìm giá trị lớn nhất</h2>
	<p style="text-align: justify;">Giả sử ta cần tìm giá trị lớn nhất của các phần tử có vị trí trong đoạn $latex [2,5]$.</p>
	<p style="text-align: justify;">Ta sẽ đi từ gốc xuống. Đoạn $latex [1,6]$ không nằm hẳn trong đoạn $latex [2,5]$, nên ta không thể lấy giá trị 6 để cập nhật cho kết quả. Nhưng ta nhận thấy 2 đoạn này giao nhau. Do đó chắc chắn có thể có một hoặc nhiều nút con hoặc cháu của nút gốc nằm trong đoạn $latex [2,5]$. Vì vậy ta sẽ đi tiếp xuống 2 nút con của nút này.</p>
	<p style="text-align: justify;">Với mỗi nút con, nếu nó vẫn giao nhưng không nằm trong đoạn cần tìm, ta lại tiếp tục đi xuống các nút con của nó. Ngược lại, có hai khả năng sau:</p>

	<ul style="text-align: justify;">
		<li style="text-align: justify;">Nếu nút đang xét quản lý một đoạn không giao với đoạn cần tìm, ta có thể bỏ qua nó và không đi xuống tiếp. Ví dụ nút 8, ta sẽ xuống nút này từ nút 4. Nút này quản lý đoạn $latex [1,1]$ không giao với đoạn $latex [2,5]$ nên ta không cập nhật giá trị nút này với kết quả, và cũng không đi tiếp nữa, vì các nút con của nó chắc chắn không thuộc đoạn cần tìm (trong trường hợp này nút 8 là nút lá nên nó không có nút con).</li>
		<li style="text-align: justify;">Nếu nút đang xét nằm trong đoạn cần tìm, ta lập tức cập nhật giá trị của nút này với kết quả, và không cần đi xuống nữa, vì nút này là giá trị lớn nhất của các nút con của nó, nên việc đi xuống các nút con của nó là thừa. Ví dụ nút 6 quản lý đoạn $latex [4,5]$ nằm trong đoạn $latex [2,5]$, vì vậy ta cập nhật luôn giá trị nút này với kết quả và không đi tiếp xuống hai nút con là nút 10 và 11 nữa.</li>
	</ul>
	<p style="text-align: justify;">Dưới đây là minh hoạ quá trình tìm giá trị lớn nhất trong đoạn $latex [2,5]$:</p>
	<p style="text-align: justify;"><img class=" size-full wp-image-143 aligncenter" src="https://liv1n9.files.wordpress.com/2018/02/segment_tree-2.png" alt="segment_tree (2)" width="504" height="381" /></p>

	<ul style="text-align: justify;">
		<li style="text-align: justify;">Các nút có màu là các nút được duyệt đến, ngược lại không được duyệt đến.</li>
		<li style="text-align: justify;">Các nút màu xanh lơ là các nút quản lý đoạn giao với đoạn cần tìm, nhưng không thuộc đoạn cần tìm.</li>
		<li style="text-align: justify;">Các nút màu da cam là các nút quản lý đoạn không giao với đoạn cần tìm.</li>
		<li style="text-align: justify;">Các nút màu xanh lá cây là các nút quản lý đoạn nằm trong đoạn cần tìm.</li>
		<li style="text-align: justify;">Ta cập nhật giá trị các nút màu xanh lá cây với kết quả. Như vậy giá trị lớn nhất cần tìm là 5.</li>
	</ul>
	<p style="text-align: justify;">Như vậy, ta có cách tìm đệ quy như sau:</p>
	<p style="text-align: justify;">Xét hàm <code>get(k, l, r, x, y)</code> trả về giá trị lớn nhất của các nút con hoặc cháu quản lý các đoạn thuộc đoạn $latex [x,y]$ và thuộc cây con có gốc là nút $latex k$, quản lý đoạn $latex [l,r]$:</p>

	<ul style="text-align: justify;">
		<li>Nếu nút $latex k$ quản lý đoạn nằm ngoài đoạn cần tìm, ta dừng lại không đi tiếp nữa</li>
		<li>Nếu nút $latex k$ quản lý đoạn nằm trong đoạn cần tìm, cập nhật kết quả với giá trị của nút và không đi tiếp nữa</li>
		<li>Trường hợp còn lại (đoạn mà nút quản lý giao với đoạn cần tìm), lấy kết quả tìm được từ 2 nút con của nút $latex k$, sau đó kết quả của hàm là giá trị lớn nhất trong 2 giá trị vừa tìm từ 2 nút con.</li>
	</ul>
	<p style="text-align: justify;">Độ phức tạp cho việc tìm giá trị đã được <a href="https://cs.stackexchange.com/questions/37669/time-complexity-proof-for-segment-tree-implementation-of-the-ranged-sum-problem" target="_blank" rel="noopener">chứng minh</a> bằng quy nạp là $latex o(log(n))$.</p>
	<p style="text-align: justify;"><a href="https://ideone.com/GAGwnR" target="_blank" rel="noopener">Code ví dụ</a>.</p>
	<p style="text-align: justify;">Cuối cùng, ta cần một lời gọi hàm để tìm được kết quả.</p>

	<h2 style="text-align: justify;">Thay đổi giá trị một phần tử</h2>
	<p style="text-align: justify;">Khi thay đổi giá trị một phần tử, việc ta cần làm là cập nhật lại giá trị các nút quản lý đoạn chứa phần tử này. Ta có thể làm như sau:</p>
	<p style="text-align: justify;">Bắt đầu từ nút lá quản lý phần tử cần thay giá trị.</p>

	<ul style="text-align: justify;">
		<li>Cập nhật giá trị của nút với giá trị mới.</li>
		<li>Nếu chưa phải gốc của cây thì đi lên nút cha của nó.</li>
	</ul>
	<p style="text-align: justify;">Ví dụ thay giá trị $latex a_2 = 8$:</p>
	<p style="text-align: justify;"><img class=" size-full wp-image-188 aligncenter" src="https://liv1n9.files.wordpress.com/2018/02/segment_tree-12.png" alt="segment_tree (1)" width="504" height="820" /></p>
	<p style="text-align: justify;">Cách cài đặt này khá hiệu quả, nếu như ta biết ngay nút lá quản lý phần tử cần thay đổi là nút nào. Trong khi đó để tìm được nút lá này, ta cần một thuật toán tìm kiếm nhị phân như sau:</p>

	<ul style="text-align: justify;">
		<li>Nếu nút đang xét chưa phải nút lá, đi xuống nút con quản lý đoạn chứa phần tử cần thay đổi. Dễ thấy chỉ có một trong hai nút con thoả mãn điều này.</li>
		<li>Ngược lại, nút lá này là nút cần tìm.</li>
	</ul>
	<p style="text-align: justify;">Thay vì viết riêng một hàm để tìm nút lá và một hàm để cập nhật, ta có thể cập nhật luôn trong quá trình tìm nút lá. Hàm cập nhật được viết đệ quy như sau:</p>
	<p style="text-align: justify;">Xét hàm <code>update(k, l, r, x, v)</code> cập nhập cây con có gốc là nút $latex k$, quản lý đoạn $latex [l,r]$ và thao tác thay đổi giá trị $latex a_x=v$:</p>

	<ul style="text-align: justify;">
		<li>Nếu nút $latex k$ quản lý đoạn không chứa phần tử thứ $latex x$, ta dừng lại không đi xuống nữa.</li>
		<li>Nếu nút $latex k$ là nút lá, thay giá trị của nút là $latex v$.</li>
		<li>Trường hợp còn lại, cập nhật 2 cây con có gốc là 2 nút con của nút $latex k$ (mặc dù ta đi xuống 2 nút con nhưng chắc chắn có một nút sẽ không xét tiếp sau đó). Giá trị mới của nút $latex k$ là giá trị lớn nhất trong 2 giá trị của 2 nút con sau khi đã cập nhật xong.</li>
	</ul>
	<p style="text-align: justify;">Độ phức tạp: $latex o(log(n))$, vì ở mỗi mức của cây, ta chỉ xét nhiều nhất là 2 nút và độ cao của cây là $latex log(n)$. Cuối cùng sẽ là lời gọi hàm <code>update(1, 1, n, x, v)</code> để thực hiện việc cập nhật.</p>
	<p style="text-align: justify;"><a href="https://ideone.com/lervtx">Code ví dụ</a>.</p>
	Một số bài toán sử dụng segment tree.
	</div>
	</div>
	<div class="footer">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 float-left">
					<i class="fa fa-facebook-f"></i>
					<i class="fa fa-twitter"></i>
					<i class="fa fa-google-plus"></i>
					<i class="fa fa-youtube"></i>
				</div>
				<div class="col-sm-6 float-right">
					<div class="col-sm-4 float-left text-center">Copyright &copy; 2018</div>
					<div class="col-sm-4 float-left text-center">Theme: Regular</div>
					<div class="col-sm-4 float-left text-center">Powered by WordPress</div>
				</div>
			</div>
		</div>
	</div>
</div>	
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
</body>
</html>